# 计算机系统概述

## 硬件

> 字
- 64位 8字节
- 32位 4字节
字节 8bit

### 冯·诺依曼机：控制流驱动方式
- 以运算器为中心
- 由五大部件组成
- 指令和数据用二进制表示，同等地位存于存储器，按地址寻访
- 指令由操作码和地址码组成
- 存储程序

### 发展历程

- 第一代 电子管
- 第二代 晶体管
- 第三代 中小规模集成电路
- 第四代 大规模、超大规模集成电路

### 硬件组成

**存储器**
- 存储体
- 存储地址寄存器MAR
- 存储数据寄存器MDR

**运算器**
- 累加器ACC
- 乘商寄存器MQ
- 操作数寄存器X
- **算术逻辑单元ALU**：实现各种算术运算逻辑运算

**控制器**
- **控制单元CU**：给出控制信号，执行指令
- 指令寄存器IR：分析当前指令
    > 对程序员透明
- 程序计数器PC：下一条指令地址
    > 可通过JMP设置

### 工作流程
- 指令、数据存入主存，PC指向第一条指令
- 从主存取指令放入IR，PC自动加一，CU分析指令，CU指挥其他部件执行指令

## 软件
> 指令集体系结构ISA：定义计算机支持哪些指令、作用、用法

翻译程序
- 高级语言
    > ↓编译 编译器
- 汇编语言
    > ↓汇编 汇编器
- 机器语言

- 高级语言
    > 编译：一次性
    > 解释 解释器：边翻译边执行
- 机器语言

## 层次结构
- 虚拟机器 高级语言
- 虚拟机器 汇编语言
- 虚拟机器 操作系统（提供广义指令/系统调用）
- 传统机器 机器语言
- 微程序机器 微指令系统（硬件执行微指令）

## 工作原理
- 源程序 `.c`
    > ↓预处理器
- 预处理后的源程序 `.i`
    > ↓编译器
- 汇编语言程序 `.s`
    > ↓汇编器
- 机器语言程序（目标模块）+其他被引目标模块 `.o`
    > ↓链接器
- 可执行文件 `.exe`

## 性能指标

**存储器**
- MAR位数 存储单元个数为$2^n$
- MDR位数 存储单元字长（大小）
容量=存储单元个数*存储字节（bit）
> 文件大小$K=2^10$ $M=2^20$ $G=2^3$0 $T=2^40$

**CPU**
- 主频f：1/时钟周期T
- CPI：每条指令所需的时钟周期数
- CPU耗时：指令数量*CPI/主频
- 每秒执行多少条指令IPS：主频/CPI
- 浮点运算FLOPS
- 机器字长：一次可处理的二进制代码长度
> 与通用寄存器、ALU长度相同

> 频率、数量级$K=10^3$ $M=10^6$ $G=10^9$ $T=10^12$

**系统**
- 数据通路带宽：数据总线并行传送信息的位数
- 吞吐量：单位时间内处理请求数量
- 响应时间：从发送请求到做出响应（得到结果）的时间

> 指令系统等方面同样会影响

# 数据的表示和运算

## 进位计数制

- 二进制B
- 十进制D
- 0x十六进制H
> 除n取余（倒过来），乘n取整（正着，可能循环）

- 真值 符合人类习惯，带正负号
- 机器数 将正负号数字化

## 定点数 
- 无符号数 没有符号位
    > 通常只有整数
- 有符号数（分开表示）
    - 定点整数 符号位 数值部分 小数点位置（隐含）
    - 定点小数 符号位 小数点位置（隐含） 数值部分

- **原码** $n+1$位表示范围位$±(2^n-1)$/$1-2^{-n}$（正负0占两个）
- **反码** 符号位为0相同，符号位为1**尾数**取反，其余同原码
- **补码** 符号位为0相同，符号位为1反码**尾数**+1（0只有1个，多表示$-2^n$）
    > 原码 ↔ 补码：末位取反，然后+1
    > 从$[x]_补$求$[-x]_补$：符号、数值位全部取反，末位+1
- **移码** 补码符号位取反，全0最小，全1最大

> 原码、反码、补码：定点整数和小数
> 移码：定点整数

> 偏置值：将有符号数转化为无符号数存储

### 加减运算

> a的补数：模-|a|（+补码）
> 字长n位的计算机天然完成$\mod n$运算

### 强制类型转换
- 无符号位与有符号位：不改变数据
- 长整数变为短整数：只保留低位
- 短整数变长整数：高位添0
> c语言中定点整数用**补码**存储

### 零扩展和无符号扩展
- 无符号整数 填充0
- 带符号整数 填充符号位

### 逻辑门
- 优先级：括号>非>与>或
- 多路选择器MUX
    > 可能预留1个控制信号拦截所有输入
- 三态门
> n bit进行异或，奇数个1时结果为1

### 加法器
- 一位全加器
- n bit加法器（串行进位的并行加法器）
    > 串行指进位信息，并行指输入
- 并行进位的并行加法器
- 带标志位的加法器
  - OF溢出标志 有符号数据溢出`1`或未溢出`0`
  - SF符号标志 `1`为负`0`为正
  - ZF零标志 `1`结果为零 `0`结果非零
  - CF进位/借位标志 无符号数溢出`1`或未溢出`0`

### 算数逻辑单元ALU
- 算术运算
- 逻辑运算
- 其他（求补码、直送）
> 若ALU支持k种功能，则控制信号位数$m>\lceil log_2 k \rceil$
> LU的运算数、运算结果位数与机器字长相同
> 电路实现：k个功能电路+多路选择器MUX